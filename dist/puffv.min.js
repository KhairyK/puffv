/*
 2025 © OpenDN Foundation (PHPin)
 PuffvJS — v0.0.1
 MIT LICENSE (https://kyrtproduct.license.kyrt.my.id)
 Support UMD, AMD, ESM, RequireJS
 Date: 30 November 2025 AT 10:50 UTC+8
*/
!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof module&&module.exports?module.exports=e():t.Puffv=e()}("undefined"!=typeof self?self:this,function(){let t={ocean:["#4bb8ff","#0099cc","#00c1a9","#006d77"],sunrise:["#ff6b6b","#ffa23a","#ffd93d","#ff9e00"],neon:["#ff00ff","#00f0ff","#9d00ff","#00ff88"],retro:["#c69c72","#915b48","#f2d3ab","#7a4e2d"]};function e(t){if(!t)return[0,0,0,1];if(t.startsWith("hsl")){let e=document.createElement("canvas");e.width=1,e.height=1;let i=e.getContext("2d");i.fillStyle=t,i.fillRect(0,0,1,1);let s=i.getImageData(0,0,1,1).data;return[s[0]/255,s[1]/255,s[2]/255,s[3]/255]}if(t.startsWith("#")){let r=t.replace("#","");3===r.length&&(r=r.split("").map(t=>t+t).join(""));let a=parseInt(r.substr(0,2),16),h=parseInt(r.substr(2,2),16),l=parseInt(r.substr(4,2),16);return[a/255,h/255,l/255,1]}let o=document.createElement("canvas");o.width=1,o.height=1;let n=o.getContext("2d");n.fillStyle=t,n.fillRect(0,0,1,1);let d=n.getImageData(0,0,1,1).data;return[d[0]/255,d[1]/255,d[2]/255,d[3]/255]}function i(t,e,i){let s=t.createShader(i);if(t.shaderSource(s,e),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS)){let r=t.getShaderInfoLog(s);throw t.deleteShader(s),Error("Shader compile error: "+r)}return s}return{Chart:class s{constructor(t,e={}){if(this.el="string"==typeof t?document.querySelector(t):t,!this.el)return console.error("Puffv: Element target tidak ditemukan");this.type=e.type||"bar",this.data=Array.isArray(e.data)?e.data.slice():[],this.labels=Array.isArray(e.labels)?e.labels.slice():[],this.animation=e.animation||null,this.duration="number"==typeof e.duration?e.duration:800,this.theme=e.theme||"auto",this.darkMode=!!e.darkMode,this.legend=!!e.legend,this.tooltip=!!e.tooltip,this.mode3D=!!e.mode3D,this.renderer=e.renderer||(e.webgl?"webgl":"svg"),this.zoomPan=!!e.zoomPan,this.stream=e.stream||null,this._ws=null,this._streaming=!1;let i=this.el.getBoundingClientRect();this.width=e.width||Math.max(200,Math.round(i.width))||400,this.height=e.height||Math.max(150,Math.round(i.height))||300,this._gl=null,this._glCanvas=null,this._programs={},this._state={scale:1,offsetX:0},this._colors=null,this._ro=null,this._winHandler=null,"static"===getComputedStyle(this.el).position&&(this.el.style.position="relative"),"webgl"===this.renderer&&this.type&&("bar"===this.type||"line"===this.type)&&this._initWebGL()||(this.renderer="svg"),this.render(),"undefined"!=typeof ResizeObserver?(this._ro=new ResizeObserver(()=>{let t=this.el.getBoundingClientRect(),i=Math.max(100,Math.round(t.width)),s=Math.max(80,Math.round(t.height));(i!==this.width||s!==this.height)&&(this.width=i,e.height||(this.height=s),this.render())}),this._ro.observe(this.el)):(this._winHandler=()=>{let t=this.el.getBoundingClientRect(),i=Math.max(100,Math.round(t.width)),s=Math.max(80,Math.round(t.height));(i!==this.width||s!==this.height)&&(this.width=i,e.height||(this.height=s),this.render())},window.addEventListener("resize",this._winHandler)),this.zoomPan&&this._enableZoomPan(),this.stream&&this.startStream()}render(){if(this.el)return"webgl"===this.renderer?"bar"===this.type?this._renderWebGLBar():"line"===this.type?this._renderWebGLLine():this._renderSVG():this._renderSVG()}updateData(t,e){Array.isArray(t)&&(this.data=t.slice()),Array.isArray(e)&&(this.labels=e.slice()),this._colors=null,this.render()}pushDatum(t,e){this.data.push(t),void 0!==e&&this.labels.push(e+""),this.data.length>2e3&&(this.data.shift(),this.labels.length&&this.labels.shift()),this.render()}startStream(){if(this.stream){if("ws"===this.stream.type&&this.stream.url){this._ws&&this.stopStream();try{this._ws=new WebSocket(this.stream.url,this.stream.protocol||void 0)}catch(t){console.error("Puffv: WebSocket error",t);return}this._ws.onopen=()=>{this._streaming=!0,"function"==typeof this.stream.onopen&&this.stream.onopen()},this._ws.onmessage=t=>{try{let e=JSON.parse(t.data);Array.isArray(e.data)?this.updateData(e.data,e.labels||[]):void 0!==e.value?this.pushDatum(e.value,e.label):Array.isArray(e)&&this.updateData(e)}catch(i){let s=Number(t.data);Number.isNaN(s)||this.pushDatum(s)}},this._ws.onclose=()=>{this._streaming=!1,"function"==typeof this.stream.onclose&&this.stream.onclose()},this._ws.onerror=t=>{console.error("Puffv: WebSocket error",t),"function"==typeof this.stream.onerror&&this.stream.onerror(t)}}else if("sse"===this.stream.type&&this.stream.url&&"undefined"!=typeof EventSource)this._es&&this.stopStream(),this._es=new EventSource(this.stream.url),this._es.onmessage=t=>{try{let e=JSON.parse(t.data);Array.isArray(e.data)?this.updateData(e.data,e.labels||[]):void 0!==e.value?this.pushDatum(e.value,e.label):Array.isArray(e)&&this.updateData(e)}catch(i){let s=Number(t.data);Number.isNaN(s)||this.pushDatum(s)}};else if("function"==typeof this.stream)try{this._customStreamHandle=this.stream(this)}catch(e){console.error("Puffv: stream starter error",e)}}}stopStream(){if(this._ws&&(this._ws.close(),this._ws=null,this._streaming=!1),this._es&&(this._es.close(),this._es=null),this._customStreamHandle&&"function"==typeof this._customStreamHandle.close)try{this._customStreamHandle.close()}catch(t){}}destroy(){this.stopStream(),this._ro&&this._ro.disconnect(),this._winHandler&&window.removeEventListener("resize",this._winHandler),this._glCanvas&&this._glCanvas.parentNode&&this._glCanvas.remove();let t=this.el.querySelector(".puffv-tooltip");t&&t.remove();let e=this.el.querySelector(".puffv-legend");e&&e.remove()}getColor(e){return this._colors||(Array.isArray(this.theme)?this._colors=this.theme.slice():"string"==typeof this.theme&&t[this.theme]?this._colors=t[this.theme].slice():this._colors=this.data.map(()=>`hsl(${Math.round(360*Math.random())}, 70%, 55%)`)),this._colors[e%this._colors.length]}applyDarkMode(){this.darkMode&&(this.el.style.background="#111",this.el.style.color="#eee")}renderLegend(){let t=this.el.querySelector(".puffv-legend");if(t&&t.remove(),!this.legend)return;let e=document.createElement("div");e.className="puffv-legend",e.style.display="flex",e.style.gap="10px",e.style.marginTop="6px",e.style.flexWrap="wrap",this.labels.forEach((t,i)=>{let s=document.createElement("div");s.style.display="flex",s.style.alignItems="center",s.style.fontSize="12px",s.style.color=this.darkMode?"#eee":"#222",s.innerHTML=`<span style="width:12px;height:12px;border-radius:2px;display:inline-block;margin-right:6px;background:${this.getColor(i)}"></span>${t||"Series "+(i+1)}`,e.appendChild(s)}),this.el.appendChild(e)}attachTooltip(t,e=[]){let i=this.el.querySelector(".puffv-tooltip");if(i&&i.remove(),!this.tooltip)return;let s=document.createElement("div");s.className="puffv-tooltip",s.style.position="absolute",s.style.pointerEvents="none",s.style.padding="6px 8px",s.style.fontSize="12px",s.style.background=this.darkMode?"rgba(255,255,255,0.08)":"rgba(0,0,0,0.75)",s.style.color="#fff",s.style.borderRadius="4px",s.style.opacity=0,s.style.transition="opacity .12s, transform .12s",s.style.transform="translateY(4px)",s.style.zIndex=9999,this.el.appendChild(s),e.forEach(({el:t,idx:e})=>{t&&(t.addEventListener("mousemove",t=>{let i=this.el.getBoundingClientRect(),r=t.clientX-i.left,a=t.clientY-i.top,h=this.labels[e]||"Data "+(e+1),l=void 0!==this.data[e]?this.data[e]:"";s.innerText=`${h}: ${l}`,s.style.left=r+12+"px",s.style.top=a+12+"px",s.style.opacity=1,s.style.transform="translateY(0)"}),t.addEventListener("mouseleave",()=>{s.style.opacity=0,s.style.transform="translateY(4px)"}))})}_renderSVG(){let t=this.type;this.el.innerHTML="";let e=document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.setAttribute("width",this.width),e.setAttribute("height",this.height),e.style.display="block",this.el.appendChild(e),"bar"===t){let i=Math.max(...this.data,1),s=Math.max(1,this.data.length),r=this.width/s,a=[];this.data.forEach((t,s)=>{let h=t/i*(this.height-30),l=s*r,o=this.height-h,n=document.createElementNS("http://www.w3.org/2000/svg","rect");n.setAttribute("x",l+4),n.setAttribute("y",o),n.setAttribute("width",Math.max(6,r-10)),n.setAttribute("height",h),n.setAttribute("fill",this.getColor(s)),e.appendChild(n),a.push({el:n,idx:s});let d=document.createElementNS("http://www.w3.org/2000/svg","text");d.setAttribute("x",l+r/2),d.setAttribute("y",this.height-4),d.setAttribute("text-anchor","middle"),d.setAttribute("font-size",11),d.setAttribute("fill",this.darkMode?"#eee":"#222"),d.textContent=this.labels[s]||"",e.appendChild(d)}),a.forEach(({el:t},e)=>{"grow"===this.animation?(t.style.transformOrigin="center bottom",t.style.transform="scaleY(0)",t.animate([{transform:"scaleY(0)"},{transform:"scaleY(1)"}],{duration:this.duration,fill:"forwards",delay:40*e})):"fade"===this.animation&&(t.style.opacity=0,t.animate([{opacity:0},{opacity:1}],{duration:this.duration,fill:"forwards",delay:20*e}))}),this.applyDarkMode(),this.attachTooltip(e,a),this.renderLegend();return}if("line"===t){let h=Math.max(...this.data,1),l=this.width/Math.max(1,this.data.length-1),o=this.data.map((t,e)=>{let i=this.height-t/h*(this.height-30);return`${e*l},${i}`}),n=document.createElementNS("http://www.w3.org/2000/svg","polyline");n.setAttribute("points",o.join(" ")),n.setAttribute("fill","none"),n.setAttribute("stroke",this.getColor(0)),n.setAttribute("stroke-width",2),e.appendChild(n);let d=[];if(this.data.forEach((t,i)=>{let s=this.height-t/h*(this.height-30),r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("cx",i*l),r.setAttribute("cy",s),r.setAttribute("r",4),r.setAttribute("fill",this.getColor(i)),e.appendChild(r),d.push({el:r,idx:i})}),"wave"===this.animation)try{let u=n.getTotalLength();n.style.strokeDasharray=u,n.style.strokeDashoffset=u,n.animate([{strokeDashoffset:u},{strokeDashoffset:0}],{duration:this.duration,fill:"forwards"})}catch(p){}else"fade"===this.animation&&(n.style.opacity=0,n.animate([{opacity:0},{opacity:1}],{duration:this.duration,fill:"forwards"}));this.applyDarkMode(),this.attachTooltip(e,d),this.renderLegend();return}if("pie"===t){let f=this.data.reduce((t,e)=>t+e,0)||1,g=0,c=Math.min(this.width,this.height)/2-6,$=this.width/2,m=this.height/2,b=[];this.data.forEach((t,i)=>{let s=g/f*2*Math.PI,r=(g+t)/f*2*Math.PI;g+=t;let a=`M ${$} ${m} L ${$+c*Math.cos(s-Math.PI/2)} ${m+c*Math.sin(s-Math.PI/2)} A ${c} ${c} 0 ${r-s>Math.PI?1:0} 1 ${$+c*Math.cos(r-Math.PI/2)} ${m+c*Math.sin(r-Math.PI/2)} Z`,h=document.createElementNS("http://www.w3.org/2000/svg","path");h.setAttribute("d",a),h.setAttribute("fill",this.getColor(i)),e.appendChild(h),b.push({el:h,idx:i})}),"explode"===this.animation&&b.forEach(({el:t},e)=>{t.style.transformOrigin=`${this.width/2}px ${this.height/2}px`,t.style.transform="scale(0)",t.animate([{transform:"scale(0)"},{transform:"scale(1)"}],{duration:this.duration,fill:"forwards",delay:60*e})}),this.applyDarkMode(),this.attachTooltip(e,b),this.renderLegend();return}if("radar"===t){let y=Math.max(3,this.data.length),w=Math.max(...this.data,1),v=Math.min(this.width,this.height)/2-30,A=this.width/2,_=this.height/2,x=4;for(let C=x;C>=1;C--){let S=v*C/x,E=[];for(let R=0;R<y;R++){let L=2*Math.PI*R/y-Math.PI/2,k=A+S*Math.cos(L),P=_+S*Math.sin(L);E.push(`${k},${P}`)}let T=document.createElementNS("http://www.w3.org/2000/svg","polygon");T.setAttribute("points",E.join(" ")),T.setAttribute("fill","none"),T.setAttribute("stroke",this.darkMode?"#444":"#ddd"),T.setAttribute("stroke-width",1),e.appendChild(T)}for(let D=0;D<y;D++){let B=2*Math.PI*D/y-Math.PI/2,F=A+v*Math.cos(B),I=_+v*Math.sin(B),N=document.createElementNS("http://www.w3.org/2000/svg","line");N.setAttribute("x1",A),N.setAttribute("y1",_),N.setAttribute("x2",F),N.setAttribute("y2",I),N.setAttribute("stroke",this.darkMode?"#444":"#ddd"),N.setAttribute("stroke-width",1),e.appendChild(N);let M=document.createElementNS("http://www.w3.org/2000/svg","text");M.setAttribute("x",1.04*F),M.setAttribute("y",1.04*I),M.setAttribute("font-size",12),M.setAttribute("fill",this.darkMode?"#eee":"#222"),M.setAttribute("text-anchor","middle"),M.textContent=this.labels[D]||"",e.appendChild(M)}let G=[],W=[];for(let Y=0;Y<y;Y++){let U=this.data[Y]||0,H=2*Math.PI*Y/y-Math.PI/2,z=U/w*v,V=A+z*Math.cos(H),O=_+z*Math.sin(H);G.push(`${V},${O}`);let X=document.createElementNS("http://www.w3.org/2000/svg","circle");X.setAttribute("cx",V),X.setAttribute("cy",O),X.setAttribute("r",4),X.setAttribute("fill",this.getColor(Y)),e.appendChild(X),W.push({el:X,idx:Y})}let q=document.createElementNS("http://www.w3.org/2000/svg","polygon");q.setAttribute("points",G.join(" ")),q.setAttribute("fill",this.getColor(0)),q.setAttribute("fill-opacity",.18),q.setAttribute("stroke",this.getColor(0)),q.setAttribute("stroke-width",2),e.appendChild(q),this.applyDarkMode(),this.attachTooltip(e,W),this.renderLegend();return}this.applyDarkMode(),this.renderLegend()}_initWebGL(){try{let t=this.el.querySelector(".puffv-gl");t&&t.remove();let e=document.createElement("canvas");e.className="puffv-gl",e.style.display="block",e.style.width="100%",e.style.height="100%",e.width=Math.max(1,Math.round(this.width)),e.height=Math.max(1,Math.round(this.height)),this.el.appendChild(e);let i=e.getContext("webgl")||e.getContext("experimental-webgl");if(!i)return e.remove(),!1;return this._gl=i,this._glCanvas=e,this._buildWebGLPrograms(i),!0}catch(s){return console.warn("Puffv: WebGL init failed",s),!1}}_buildWebGLPrograms(t){let e=`
        attribute vec2 a_pos;
        attribute vec4 a_color;
        varying vec4 v_color;
        void main() {
          gl_Position = vec4(a_pos, 0.0, 1.0);
          v_color = a_color;
        }
      `,s=`
        precision mediump float;
        varying vec4 v_color;
        void main() {
          gl_FragColor = v_color;
        }
      `;try{this._programs.basic=function t(e,s,r){let a=i(e,s,e.VERTEX_SHADER),h=i(e,r,e.FRAGMENT_SHADER),l=e.createProgram();if(e.attachShader(l,a),e.attachShader(l,h),e.linkProgram(l),!e.getProgramParameter(l,e.LINK_STATUS)){let o=e.getProgramInfoLog(l);throw e.deleteProgram(l),Error("Program link error: "+o)}return l}(this._gl,e,s)}catch(r){console.warn("Puffv: WebGL program compile failed",r),this._programs={}}}_clearGL(){if(!this._gl)return;let t=this._gl;t.viewport(0,0,this._glCanvas.width,this._glCanvas.height),t.clearColor(this.darkMode?.07:1,this.darkMode?.07:1,this.darkMode?.07:1,1),t.clear(t.COLOR_BUFFER_BIT)}_convertToClip(t,e){let i=t/this.width*2-1,s=-(e/this.height*2-1);return[i,s]}_renderWebGLBar(){if(!this._gl||!this._programs.basic)return this._renderSVG();let t=this._gl,i=Math.max(1,Math.round(this.width)),s=Math.max(1,Math.round(this.height));(this._glCanvas.width!==i||this._glCanvas.height!==s)&&(this._glCanvas.width=i,this._glCanvas.height=s),this._clearGL();let r=Math.max(...this.data,1),a=Math.max(1,this.data.length),h=this.width/a,l=[],o=[];for(let n=0;n<a;n++){let d=this.data[n]||0,u=d/r*(this.height-30),p=n*h+4,f=this.height-u,g=Math.max(6,h-10),c=u,[$,m]=this._convertToClip(p,f),[b,y]=this._convertToClip(p+g,f),[w,v]=this._convertToClip(p,f+c),[A,_]=this._convertToClip(p+g,f+c);l.push($,m,b,y,w,v,w,v,b,y,A,_);let x=e(this.getColor(n));for(let C=0;C<6;C++)o.push(x[0],x[1],x[2],x[3])}let S=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,S),t.bufferData(t.ARRAY_BUFFER,new Float32Array(l),t.STATIC_DRAW);let E=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,E),t.bufferData(t.ARRAY_BUFFER,new Float32Array(o),t.STATIC_DRAW);let R=this._programs.basic;t.useProgram(R);let L=t.getAttribLocation(R,"a_pos");t.enableVertexAttribArray(L),t.bindBuffer(t.ARRAY_BUFFER,S),t.vertexAttribPointer(L,2,t.FLOAT,!1,0,0);let k=t.getAttribLocation(R,"a_color");t.enableVertexAttribArray(k),t.bindBuffer(t.ARRAY_BUFFER,E),t.vertexAttribPointer(k,4,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLES,0,l.length/2);let P=this.el.querySelector(".puffv-overlay");P&&P.remove();let T=document.createElementNS("http://www.w3.org/2000/svg","svg");T.setAttribute("width",this.width),T.setAttribute("height",this.height),T.classList.add("puffv-overlay"),T.style.position="absolute",T.style.left="0",T.style.top="0",T.style.pointerEvents="none",T.style.overflow="visible";let D=[];for(let B=0;B<a;B++){let F=this.data[B]||0,I=F/r*(this.height-30),N=B*h+4,M=this.height-I,G=Math.max(6,h-10),W=document.createElementNS("http://www.w3.org/2000/svg","rect");W.setAttribute("x",N),W.setAttribute("y",M),W.setAttribute("width",G),W.setAttribute("height",I),W.setAttribute("fill","transparent"),W.style.pointerEvents="auto",T.appendChild(W),D.push({el:W,idx:B})}this.el.appendChild(T),this.applyDarkMode(),this.attachTooltip(T,D),this.renderLegend(),t.deleteBuffer(S),t.deleteBuffer(E)}_renderWebGLLine(){if(!this._gl||!this._programs.basic)return this._renderSVG();let t=this._gl,i=Math.max(1,Math.round(this.width)),s=Math.max(1,Math.round(this.height));(this._glCanvas.width!==i||this._glCanvas.height!==s)&&(this._glCanvas.width=i,this._glCanvas.height=s),this._clearGL();let r=Math.max(...this.data,1),a=this.width/Math.max(1,this.data.length-1),h=[],l=[];for(let o=0;o<this.data.length;o++){let n=o*a,d=this.height-(this.data[o]||0)/r*(this.height-30),[u,p]=this._convertToClip(n,d);h.push(u,p);let f=e(this.getColor(0));l.push(f[0],f[1],f[2],f[3])}let g=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,g),t.bufferData(t.ARRAY_BUFFER,new Float32Array(h),t.STATIC_DRAW);let c=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,c),t.bufferData(t.ARRAY_BUFFER,new Float32Array(l),t.STATIC_DRAW);let $=this._programs.basic;t.useProgram($);let m=t.getAttribLocation($,"a_pos");t.enableVertexAttribArray(m),t.bindBuffer(t.ARRAY_BUFFER,g),t.vertexAttribPointer(m,2,t.FLOAT,!1,0,0);let b=t.getAttribLocation($,"a_color");t.enableVertexAttribArray(b),t.bindBuffer(t.ARRAY_BUFFER,c),t.vertexAttribPointer(b,4,t.FLOAT,!1,0,0);try{t.lineWidth(2)}catch(y){}t.drawArrays(t.LINE_STRIP,0,h.length/2);let w=document.createElementNS("http://www.w3.org/2000/svg","svg");w.setAttribute("width",this.width),w.setAttribute("height",this.height),w.classList.add("puffv-overlay"),w.style.position="absolute",w.style.left="0",w.style.top="0",w.style.pointerEvents="none";let v=[];for(let A=0;A<this.data.length;A++){let _=A*a,x=this.height-(this.data[A]||0)/r*(this.height-30),C=document.createElementNS("http://www.w3.org/2000/svg","circle");C.setAttribute("cx",_),C.setAttribute("cy",x),C.setAttribute("r",5),C.setAttribute("fill",this.getColor(A)),C.style.pointerEvents="auto",w.appendChild(C),v.push({el:C,idx:A})}this.el.appendChild(w),this.applyDarkMode(),this.attachTooltip(w,v),this.renderLegend(),t.deleteBuffer(g),t.deleteBuffer(c)}_enableZoomPan(){let t=!1,e=0,i=this._state.offsetX||0,s="webgl"===this.renderer&&this._glCanvas?this._glCanvas:this.el;s.addEventListener("wheel",t=>{t.preventDefault();let e=t.deltaY<0?1.08:.92;this._state.scale*=e,this._state.scale=Math.max(.5,Math.min(this._state.scale,6)),this.render()},{passive:!1}),s.addEventListener("mousedown",s=>{t=!0,e=s.clientX,i=this._state.offsetX||0}),window.addEventListener("mouseup",()=>t=!1),window.addEventListener("mousemove",s=>{if(!t)return;let r=s.clientX-e;this._state.offsetX=i+r,this.render()})}}}});
